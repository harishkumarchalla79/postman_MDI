{
	"info": {
		"_postman_id": "f23269ed-e69d-44a2-9059-cd342aa95fb3",
		"name": "WKC-MDI - Job Flow",
		"description": "Api Documentation:\nhttps://test.cloud.ibm.com/apidocs/watson-data-api#introduction",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "IAM",
			"item": [
				{
					"name": "Get Roles",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{BearerTokenCloud}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{iam_endpoint}}/v1/roles?account_id={{AccountID}}&iam_id={{IAM_ID}}",
							"host": [
								"{{iam_endpoint}}"
							],
							"path": [
								"v1",
								"roles"
							],
							"query": [
								{
									"key": "account_id",
									"value": "{{AccountID}}"
								},
								{
									"key": "iam_id",
									"value": "{{IAM_ID}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Policies",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{BearerTokenCloud}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{iam_endpoint}}/v1/policies?account_id={{AccountID}}&iam_id={{IAM_ID}}",
							"host": [
								"{{iam_endpoint}}"
							],
							"path": [
								"v1",
								"policies"
							],
							"query": [
								{
									"key": "account_id",
									"value": "{{AccountID}}"
								},
								{
									"key": "iam_id",
									"value": "{{IAM_ID}}"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Login",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"var jsonData = pm.response.json();",
							"pm.collectionVariables.set(\"BearerToken\", jsonData.token);",
							"",
							"pm.test(\"Status code is 200\", function () {",
							"  pm.response.to.have.status(200);",
							"  pm.response.to.have.status(\"OK\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\"username\":\"admin\",\"password\":\"password\"}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{endpoint}}/icp4d-api/v1/authorize",
					"host": [
						"{{endpoint}}"
					],
					"path": [
						"icp4d-api",
						"v1",
						"authorize"
					]
				}
			},
			"response": []
		},
		{
			"name": "get connection types",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{BearerToken}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n     \"datasource_type\": \"IBM Db2 database\",\r\n     \"name\":\"My-DB2-Connection\",\r\n     \"properties\": {\r\n       \"host\":\"dashdb-txn-sbox-yp-dal09-04.services.dal.bluemix.net\",\r\n       \"port\":\"50000\",\r\n       \"database\":\"BLUDB\",\r\n       \"username\": \"pjr63472\",\r\n       \"password\": \"bs1cbr6vknnn3^6w\"\r\n     }\r\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{endpoint}}/v2/datasource_types?connection_properties=true",
					"host": [
						"{{endpoint}}"
					],
					"path": [
						"v2",
						"datasource_types"
					],
					"query": [
						{
							"key": "connection_properties",
							"value": "true"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Create MDI Asset",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"var jsonData = pm.response.json();\r",
							"pm.collectionVariables.set(\"MDI_assetref\", jsonData.metadata.asset_id);\r",
							"\r",
							"pm.test(\"Status code is 201\", function () {\r",
							"  pm.response.to.have.status(201);\r",
							"  pm.response.to.have.status(\"Created\");\r",
							"});\r",
							"\r",
							"pm.test(\"Body contains string\",() => {\r",
							"  pm.expect(pm.response.text()).to.include(\"metadata_import\");\r",
							"});"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"pm.collectionVariables.set(\"$$timestamp\",new Date());"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{BearerToken}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"description\": \"{{mdiDescription}}\",\n  \"name\": \"MDI - {{$$timestamp}}\",\n  \"connection_id\": \"{{connectionId}}\",\n  \"target_project_id\": \"{{projectId}}\",\n  \"target_catalog_id\": null,\n  \"scope\": {\"paths\": [\"\"]}\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{endpoint}}/v2/metadata_imports?project_id={{projectId}}",
					"host": [
						"{{endpoint}}"
					],
					"path": [
						"v2",
						"metadata_imports"
					],
					"query": [
						{
							"key": "project_id",
							"value": "{{projectId}}"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Get Datasource Types",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Content-Type",
						"type": "text",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"type": "text",
						"value": "Bearer {{BearerToken}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{endpoint}}/v2/datasource_types",
					"host": [
						"{{endpoint}}"
					],
					"path": [
						"v2",
						"datasource_types"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create Job",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"var jsonData = pm.response.json();\r",
							"pm.collectionVariables.set(\"job_assetref\", jsonData.metadata.asset_id);"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"type": "text",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"type": "text",
						"value": "Bearer {{BearerToken}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"job\": {\n        \"asset_ref\": \"{{MDI_assetref}}\",\n        \"name\": \"job - {{$$timestamp}}\",\n        \"description\": \"job for mdi - {{MDI_assetref}} \",\n        \"configuration\":{}\n    }\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{endpoint}}/v2/jobs?project_id={{projectId}}",
					"host": [
						"{{endpoint}}"
					],
					"path": [
						"v2",
						"jobs"
					],
					"query": [
						{
							"key": "project_id",
							"value": "{{projectId}}"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Patch MDI Job",
			"request": {
				"method": "PATCH",
				"header": [
					{
						"key": "Content-Type",
						"type": "text",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"type": "text",
						"value": "Bearer {{BearerToken}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"job_id\":\"{{job_assetref}}\"\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{endpoint}}/v2/metadata_imports/{{MDI_assetref}}?project_id={{projectId}}",
					"host": [
						"{{endpoint}}"
					],
					"path": [
						"v2",
						"metadata_imports",
						"{{MDI_assetref}}"
					],
					"query": [
						{
							"key": "project_id",
							"value": "{{projectId}}"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "RUN MDI Job Run",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"var jsonData = pm.response.json();\r",
							"pm.collectionVariables.set(\"job_run_id\", jsonData.metadata.asset_id);"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"type": "text",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"type": "text",
						"value": "Bearer {{BearerToken}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n  \"job_run\":{}\r\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{endpoint}}/v2/jobs/{{job_assetref}}/runs?project_id={{projectId}}&job_id{{={{job_assetref}}",
					"host": [
						"{{endpoint}}"
					],
					"path": [
						"v2",
						"jobs",
						"{{job_assetref}}",
						"runs"
					],
					"query": [
						{
							"key": "project_id",
							"value": "{{projectId}}"
						},
						{
							"key": "job_id{{",
							"value": "{{job_assetref}}"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "RUN MDI2 Job Run Cancel",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 204\", function () {\r",
							"  pm.response.to.have.status(204);\r",
							"  pm.response.to.have.status(\"No Content\");\r",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"type": "text",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"type": "text",
						"value": "Bearer {{BearerToken}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{endpoint}}/v2/jobs/{{job_assetref}}/runs/{{job_run_id}}/cancel?project_id={{projectId}}",
					"host": [
						"{{endpoint}}"
					],
					"path": [
						"v2",
						"jobs",
						"{{job_assetref}}",
						"runs",
						"{{job_run_id}}",
						"cancel"
					],
					"query": [
						{
							"key": "project_id",
							"value": "{{projectId}}"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "RUN MDI Job Delete",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 204\", function () {\r",
							"  pm.response.to.have.status(204);\r",
							"  pm.response.to.have.status(\"No Content\");\r",
							"});"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "DELETE",
				"header": [
					{
						"key": "Content-Type",
						"type": "text",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"type": "text",
						"value": "Bearer {{BearerToken}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{endpoint}}/v2/jobs/{{job_assetref}}/runs/{{job_run_id}}?project_id={{projectId}}",
					"host": [
						"{{endpoint}}"
					],
					"path": [
						"v2",
						"jobs",
						"{{job_assetref}}",
						"runs",
						"{{job_run_id}}"
					],
					"query": [
						{
							"key": "project_id",
							"value": "{{projectId}}"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Delete MDI Asset",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 204\", function () {\r",
							"  pm.response.to.have.status(204);\r",
							"  pm.response.to.have.status(\"No Content\");\r",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "DELETE",
				"header": [
					{
						"key": "Content-Type",
						"type": "text",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"type": "text",
						"value": "Bearer {{BearerToken}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{endpoint}}/v2/metadata_imports/{{MDI_assetref}}?project_id={{projectId}}",
					"host": [
						"{{endpoint}}"
					],
					"path": [
						"v2",
						"metadata_imports",
						"{{MDI_assetref}}"
					],
					"query": [
						{
							"key": "project_id",
							"value": "{{projectId}}"
						}
					]
				}
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "apikey",
			"value": "fus7D1RlSsvh_Xrz3gNDc3pimZJS_rGHy5hh28QkC1y0"
		},
		{
			"key": "BearerToken",
			"value": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6IkFkbWluIiwicGVybWlzc2lvbnMiOlsiYWRtaW5pc3RyYXRvciIsImNhbl9wcm92aXNpb24iLCJtYW5hZ2VfY2F0YWxvZyIsImF1dGhvcl9nb3Zlcm5hbmNlX2FydGlmYWN0cyIsIm1hbmFnZV9nb3Zlcm5hbmNlX3dvcmtmbG93Iiwidmlld19nb3Zlcm5hbmNlX2FydGlmYWN0cyIsIm1hbmFnZV9jYXRlZ29yaWVzIiwibWFuYWdlX3F1YWxpdHkiLCJtYW5hZ2VfaW5mb3JtYXRpb25fYXNzZXRzIiwibWFuYWdlX2Rpc2NvdmVyeSIsIm1hbmFnZV9tZXRhZGF0YV9pbXBvcnQiLCJhY2Nlc3NfY2F0YWxvZyIsInZpZXdfcXVhbGl0eSIsImFjY2Vzc19pbmZvcm1hdGlvbl9hc3NldHMiXSwiZ3JvdXBzIjpbMTAwMDBdLCJzdWIiOiJhZG1pbiIsImlzcyI6IktOT1hTU08iLCJhdWQiOiJEU1giLCJ1aWQiOiIxMDAwMzMwOTk5IiwiYXV0aGVudGljYXRvciI6ImRlZmF1bHQiLCJpYXQiOjE2MTc2NDUxMjgsImV4cCI6MTYxNzY4ODI5Mn0.gByNGi0JvaXvWHaJ4Yy9dOmsuYD1ubi4JVWUhuQX1hJou90Bwt4mK6G9__ZbfwZEWMCyvmuGCuAJjs44xPeHw7oYcYIr6OzQqNuhp5Oql_YejHB4IndAV2nawwN552-59H13YsnhSNfaXreZXskJeb2sJikCyEb0xquMYauAkli2O05gBdIV_FEgeY16AuUc2p2fH-HgPzCh-_x13M-rJ4X1IOIcztNJQuiUX386DO2S7EpogE2WhXxJgN81N8fIoJMRDXXhtjiadQPO5IPrFIYUTE4kRSrqwL2DnqhjyfSJ_1QADV46yFcFRIllGnyffZ6pmuEhkQFGda4jHhnbGQ"
		},
		{
			"key": "endpoint",
			"value": "https://cpd-wkc.apps.cpd400-oprstaging.cp.fyre.ibm.com"
		},
		{
			"key": "AccountID",
			"value": "8fd4a210cf3145f8b8b05af3f9aa376d"
		},
		{
			"key": "iam_endpoint",
			"value": "https://iam.test.cloud.ibm.com"
		},
		{
			"key": "IAM_ID",
			"value": "IBMid-550002J5V0"
		},
		{
			"key": "projectId",
			"value": "13debbfb-8c1b-47a0-aac8-def513007867"
		},
		{
			"key": "connectionId",
			"value": "2a4bd6ad-243a-4c5a-ac43-da57decd7796"
		},
		{
			"key": "jobId",
			"value": ""
		},
		{
			"key": "metadataImportId",
			"value": ""
		},
		{
			"key": "MDI_assetref",
			"value": ""
		},
		{
			"key": "$$timestamp",
			"value": ""
		},
		{
			"key": "job_assetref",
			"value": ""
		},
		{
			"key": "job_run_id",
			"value": ""
		}
	]
}